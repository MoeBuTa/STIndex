# Schema Discovery Configuration

# Cluster-level dimensional discovery (unified approach - no separate discovery phase)
cluster_discovery:
  num_clusters: 10

  # Adaptive first batch sizing
  # First batch uses adaptive size based on cluster size for discovery
  # Subsequent batches use standard batch_size for refinement
  adaptive_batching:
    enabled: true
    # Minimum size for first batch
    min_size: 50
    # Maximum size for first batch
    max_size: 150
    # First batch as percentage of cluster size (0.10 = 10%)
    ratio: 0.10

# Per-cluster entity extraction
entity_extraction:
  # Number of questions to batch in a single LLM call (for batches after the first)
  # Higher values = faster but may reduce extraction quality
  # Lower values = slower but better context tracking
  batch_size: 50

  # Maximum number of questions to process per cluster (for testing)
  # Set to null or -1 to process all questions
  max_questions_per_cluster: null

  # Log progress every N batches
  log_interval: 10

  # Allow discovering new dimensions during entity extraction
  # When enabled, each cluster can evolve its own schema as it processes batches
  allow_new_dimensions: true

  # Decay thresholds for schema refinement
  # Controls how strict the confidence threshold is for proposing new dimensions
  # Early batches can propose dimensions more easily, later batches require higher confidence
  decay_thresholds:
    early:
      start_batch: 1   # Batches 1-2 (1-indexed)
      end_batch: 2
      threshold: 0.3   # Low threshold - easy to propose new dimensions
    medium:
      start_batch: 3   # Batches 3-5
      end_batch: 5
      threshold: 0.6   # Medium threshold - moderate difficulty
    late:
      start_batch: 6   # Batches 6+
      end_batch: 999999
      threshold: 0.9   # High threshold - rare proposals only

  # Retry configuration for handling LLM errors
  retry:
    # Maximum number of retry attempts for failed LLM calls
    max_retries: 3

    # Initial delay between retries in seconds
    initial_delay: 1.0

    # Exponential backoff multiplier (delay *= backoff_factor after each retry)
    backoff_factor: 2.0

    # Maximum delay between retries in seconds
    max_delay: 10.0

    # Whether to adjust temperature on retry (can help with JSON formatting)
    adjust_temperature: true

    # Temperature reduction on retry (0.7 -> 0.5 -> 0.3)
    temperature_reduction: 0.2

# Parallel processing
parallel:
  # Enable parallel cluster processing
  enabled: true

  # Maximum number of clusters to process in parallel
  # Set to -1 for unlimited (processes all clusters in parallel)
  max_workers: 5

  # Timeout per cluster in seconds (null for no timeout)
  cluster_timeout: 3600

# Schema merging across clusters
schema_merging:
  # Similarity threshold for fuzzy dimension name matching and entity deduplication (0.0-1.0)
  # 0.85 means strings with â‰¥85% similarity are considered duplicates
  similarity_threshold: 0.85

  # Maximum entities per dimension in final output
  max_entities_per_dimension: 1000
